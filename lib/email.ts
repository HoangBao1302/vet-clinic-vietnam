import nodemailer from 'nodemailer';

const transporter = nodemailer.createTransport({
  host: process.env.SMTP_HOST || 'smtp.gmail.com',
  port: parseInt(process.env.SMTP_PORT || '587'),
  secure: false, // true for 465, false for other ports
  auth: {
    user: process.env.SMTP_USER || 'baotong130277@gmail.com', // Use original Gmail account for auth
    pass: process.env.SMTP_PASS,
  },
  tls: {
    rejectUnauthorized: false
  }
});

export interface SendEmailOptions {
  to: string;
  subject: string;
  html: string;
}

export async function sendEmail({ to, subject, html }: SendEmailOptions) {
  try {
    // Debug logging
    console.log('üìß Attempting to send email...');
    console.log('üìß SMTP_USER:', process.env.SMTP_USER);
    console.log('üìß SMTP_HOST:', process.env.SMTP_HOST);
    console.log('üìß SMTP_PORT:', process.env.SMTP_PORT);
    console.log('üìß To:', to);
    console.log('üìß From:', process.env.SMTP_FROM || 'support@ThebenchmarkTrader.com');
    
    const info = await transporter.sendMail({
      from: `"EA Forex ThebenchmarkTrader" <${process.env.SMTP_FROM || 'support@ThebenchmarkTrader.com'}>`,
      to,
      subject,
      html,
    });

    console.log('‚úÖ Email sent successfully:', info.messageId);
    return { success: true, messageId: info.messageId };
  } catch (error) {
    console.error('‚ùå Error sending email:', error);
    console.error('‚ùå SMTP_USER:', process.env.SMTP_USER);
    console.error('‚ùå SMTP_PASS length:', process.env.SMTP_PASS?.length);
    return { success: false, error };
  }
}

// Email templates
export function getResetPasswordEmail(resetUrl: string, username: string) {
  return `
    <!DOCTYPE html>
    <html>
    <head>
      <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }
        .content { background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px; }
        .button { display: inline-block; padding: 12px 30px; background: #667eea; color: white; text-decoration: none; border-radius: 5px; margin: 20px 0; }
        .footer { text-align: center; margin-top: 30px; font-size: 12px; color: #666; }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <h1>üîê Reset M·∫≠t Kh·∫©u</h1>
        </div>
        <div class="content">
          <p>Xin ch√†o <strong>${username}</strong>,</p>
          <p>Ch√∫ng t√¥i nh·∫≠n ƒë∆∞·ª£c y√™u c·∫ßu reset m·∫≠t kh·∫©u cho t√†i kho·∫£n c·ªßa b·∫°n.</p>
          <p>Click v√†o n√∫t b√™n d∆∞·ªõi ƒë·ªÉ t·∫°o m·∫≠t kh·∫©u m·ªõi:</p>
          <center>
            <a href="${resetUrl}" class="button">Reset M·∫≠t Kh·∫©u</a>
          </center>
          <p><small>Ho·∫∑c copy link sau v√†o tr√¨nh duy·ªát:<br>${resetUrl}</small></p>
          <p><strong>‚è∞ Link n√†y s·∫Ω h·∫øt h·∫°n sau 1 gi·ªù.</strong></p>
          <p>N·∫øu b·∫°n kh√¥ng y√™u c·∫ßu reset m·∫≠t kh·∫©u, vui l√≤ng b·ªè qua email n√†y.</p>
        </div>
        <div class="footer">
          <p>&copy; 2024 EA Forex ThebenchmarkTrader. All rights reserved.</p>
        </div>
      </div>
    </body>
    </html>
  `;
}

export function getWelcomeEmail(username: string) {
  return `
    <!DOCTYPE html>
    <html>
    <head>
      <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }
        .content { background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px; }
        .button { display: inline-block; padding: 12px 30px; background: #667eea; color: white; text-decoration: none; border-radius: 5px; margin: 20px 0; }
        .footer { text-align: center; margin-top: 30px; font-size: 12px; color: #666; }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <h1>üéâ Ch√†o M·ª´ng ƒê·∫øn V·ªõi EA Forex ThebenchmarkTrader!</h1>
        </div>
        <div class="content">
          <p>Xin ch√†o <strong>${username}</strong>,</p>
          <p>C·∫£m ∆°n b·∫°n ƒë√£ ƒëƒÉng k√Ω t√†i kho·∫£n v·ªõi ch√∫ng t√¥i!</p>
          <p>T√†i kho·∫£n c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng. B·∫°n c√≥ th·ªÉ ƒëƒÉng nh·∫≠p v√† b·∫Øt ƒë·∫ßu s·ª≠ d·ª•ng c√°c d·ªãch v·ª• c·ªßa ch√∫ng t√¥i.</p>
          <h3>üéØ B·∫°n c√≥ th·ªÉ l√†m g√¨ ti·∫øp theo?</h3>
          <ul>
            <li>‚úÖ Xem c√°c g√≥i EA v√† b·∫£ng gi√°</li>
            <li>‚úÖ Tham gia ch∆∞∆°ng tr√¨nh Affiliate</li>
            <li>‚úÖ Xem k·∫øt qu·∫£ giao d·ªãch th·ª±c t·∫ø</li>
            <li>‚úÖ Download EA Demo mi·ªÖn ph√≠</li>
          </ul>
          <center>
            <a href="${process.env.NEXT_PUBLIC_SITE_URL || 'https://vet-clinic-vietnam.vercel.app'}/profile" class="button">Xem T√†i Kho·∫£n C·ªßa B·∫°n</a>
          </center>
          <p>N·∫øu b·∫°n c√≥ b·∫•t k·ª≥ c√¢u h·ªèi n√†o, ƒë·ª´ng ng·∫ßn ng·∫°i li√™n h·ªá v·ªõi ch√∫ng t√¥i!</p>
        </div>
        <div class="footer">
          <p>&copy; 2024 EA Forex ThebenchmarkTrader. All rights reserved.</p>
          <p>Email n√†y ƒë∆∞·ª£c g·ª≠i t·ª´ h·ªá th·ªëng t·ª± ƒë·ªông. Vui l√≤ng kh√¥ng reply.</p>
        </div>
      </div>
    </body>
    </html>
  `;
}

// Affiliate approval email
export function getAffiliateApprovalEmail(username: string, affiliateCode: string) {
  return `
    <!DOCTYPE html>
    <html>
    <head>
      <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }
        .content { background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px; }
        .code-box { background: #fff; border: 2px dashed #10b981; padding: 20px; text-align: center; margin: 20px 0; border-radius: 5px; }
        .code { font-size: 24px; font-weight: bold; color: #10b981; font-family: monospace; }
        .button { display: inline-block; padding: 12px 30px; background: #10b981; color: white; text-decoration: none; border-radius: 5px; margin: 20px 0; }
        .footer { text-align: center; margin-top: 30px; font-size: 12px; color: #666; }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <h1>üéä Ch√∫c M·ª´ng! Affiliate Application ƒê√£ ƒê∆∞·ª£c Duy·ªát!</h1>
        </div>
        <div class="content">
          <p>Xin ch√†o <strong>${username}</strong>,</p>
          <p>Ch√∫ng t√¥i r·∫•t vui m·ª´ng th√¥ng b√°o r·∫±ng ƒë∆°n ƒëƒÉng k√Ω Affiliate c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c <strong>PH√ä DUY·ªÜT</strong>!</p>
          
          <div class="code-box">
            <p style="margin: 0 0 10px 0; color: #666;">M√£ Affiliate c·ªßa b·∫°n:</p>
            <div class="code">${affiliateCode}</div>
          </div>

          <h3>üí∞ Hoa H·ªìng C·ªßa B·∫°n:</h3>
          <ul>
            <li><strong>30%</strong> - B√°n EA</li>
            <li><strong>25%</strong> - B√°n Kh√≥a H·ªçc</li>
            <li><strong>10%</strong> - Copy Social (recurring)</li>
          </ul>

          <h3>üöÄ B·∫Øt ƒê·∫ßu Ki·∫øm Ti·ªÅn:</h3>
          <ol>
            <li>Chia s·∫ª link affiliate c·ªßa b·∫°n</li>
            <li>Khi c√≥ ng∆∞·ªùi mua qua link c·ªßa b·∫°n</li>
            <li>B·∫°n nh·∫≠n hoa h·ªìng t·ª± ƒë·ªông</li>
          </ol>

          <center>
            <a href="${process.env.NEXT_PUBLIC_SITE_URL || 'https://vet-clinic-vietnam.vercel.app'}/profile" class="button">Xem Dashboard</a>
          </center>

          <p><strong>L∆∞u √Ω:</strong> Hoa h·ªìng s·∫Ω ƒë∆∞·ª£c thanh to√°n v√†o cu·ªëi m·ªói th√°ng qua chuy·ªÉn kho·∫£n ng√¢n h√†ng.</p>
        </div>
        <div class="footer">
          <p>&copy; 2024 EA Forex ThebenchmarkTrader. All rights reserved.</p>
        </div>
      </div>
    </body>
    </html>
  `;
}

// Affiliate rejection email
export function getAffiliateRejectionEmail(username: string, reason?: string) {
  return `
    <!DOCTYPE html>
    <html>
    <head>
      <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }
        .content { background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px; }
        .button { display: inline-block; padding: 12px 30px; background: #667eea; color: white; text-decoration: none; border-radius: 5px; margin: 20px 0; }
        .footer { text-align: center; margin-top: 30px; font-size: 12px; color: #666; }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <h1>Th√¥ng B√°o V·ªÅ Affiliate Application</h1>
        </div>
        <div class="content">
          <p>Xin ch√†o <strong>${username}</strong>,</p>
          <p>C·∫£m ∆°n b·∫°n ƒë√£ quan t√¢m ƒë·∫øn ch∆∞∆°ng tr√¨nh Affiliate c·ªßa ch√∫ng t√¥i.</p>
          <p>R·∫•t ti·∫øc, ƒë∆°n ƒëƒÉng k√Ω c·ªßa b·∫°n ch∆∞a ƒë∆∞·ª£c ch·∫•p nh·∫≠n l√∫c n√†y.</p>
          
          ${reason ? `<p><strong>L√Ω do:</strong> ${reason}</p>` : ''}

          <p>B·∫°n c√≥ th·ªÉ:</p>
          <ul>
            <li>T√≠ch l≈©y th√™m kinh nghi·ªám trong lƒ©nh v·ª±c Forex</li>
            <li>X√¢y d·ª±ng audience/community l·ªõn h∆°n</li>
            <li>ƒêƒÉng k√Ω l·∫°i sau 3 th√°ng</li>
          </ul>

          <center>
            <a href="${process.env.NEXT_PUBLIC_SITE_URL || 'https://vet-clinic-vietnam.vercel.app'}/referral" class="button">T√¨m Hi·ªÉu Th√™m</a>
          </center>

          <p>N·∫øu c√≥ th·∫Øc m·∫Øc, vui l√≤ng li√™n h·ªá support@thebenchmarktrader.com</p>
        </div>
        <div class="footer">
          <p>&copy; 2024 EA Forex ThebenchmarkTrader. All rights reserved.</p>
        </div>
      </div>
    </body>
    </html>
  `;
}

// Membership upgrade email
export function getMembershipUpgradeEmail(username: string) {
  return `
    <!DOCTYPE html>
    <html>
    <head>
      <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; padding: 30px; text-align: center; border-radius: 10px 10px 0 0; }
        .content { background: #f9f9f9; padding: 30px; border-radius: 0 0 10px 10px; }
        .feature { background: #fff; padding: 15px; margin: 10px 0; border-left: 4px solid #f59e0b; }
        .button { display: inline-block; padding: 12px 30px; background: #f59e0b; color: white; text-decoration: none; border-radius: 5px; margin: 20px 0; }
        .footer { text-align: center; margin-top: 30px; font-size: 12px; color: #666; }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="header">
          <h1>üëë Ch√†o M·ª´ng Paid Member!</h1>
        </div>
        <div class="content">
          <p>Xin ch√†o <strong>${username}</strong>,</p>
          <p>Ch√∫c m·ª´ng! T√†i kho·∫£n c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c n√¢ng c·∫•p l√™n <strong>Paid Member</strong>!</p>
          
          <h3>üéÅ Quy·ªÅn L·ª£i C·ªßa B·∫°n:</h3>
          
          <div class="feature">
            <strong>üì• Unlimited Downloads</strong>
            <p>Download kh√¥ng gi·ªõi h·∫°n EA Demo v√† Indicators</p>
          </div>

          <div class="feature">
            <strong>üì∞ Unlimited Premium Posts</strong>
            <p>ƒê·ªçc t·∫•t c·∫£ b√†i ph√¢n t√≠ch Premium kh√¥ng gi·ªõi h·∫°n</p>
          </div>

          <div class="feature">
            <strong>üéì Exclusive Content</strong>
            <p>Truy c·∫≠p kh√≥a h·ªçc v√† t√†i li·ªáu ƒë·ªôc quy·ªÅn</p>
          </div>

          <div class="feature">
            <strong>üí¨ Priority Support</strong>
            <p>H·ªó tr·ª£ ∆∞u ti√™n 24/7</p>
          </div>

          <center>
            <a href="${process.env.NEXT_PUBLIC_SITE_URL || 'https://vet-clinic-vietnam.vercel.app'}/profile" class="button">Kh√°m Ph√° Ngay</a>
          </center>

          <p>C·∫£m ∆°n b·∫°n ƒë√£ tin t∆∞·ªüng EA Forex ThebenchmarkTrader!</p>
        </div>
        <div class="footer">
          <p>&copy; 2024 EA Forex ThebenchmarkTrader. All rights reserved.</p>
        </div>
      </div>
    </body>
    </html>
  `;
}

